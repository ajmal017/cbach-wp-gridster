jQuery(function(h){var c;var a=parseInt(gridster_admin.widget_base_width,10);var j=parseInt(gridster_admin.widget_base_height,10);var g=parseInt(gridster_admin.widget_margin_x,10);var f=parseInt(gridster_admin.widget_margin_y,10);h.fn.resizeBlock=function(n){var k=n.width()-a;var m=n.height()-j;for(var l=1;k>0;k-=(a+(g*2))){l++}for(var o=1;m>0;m-=(j+(f*2))){o++}c.resize_widget(n,l,o)};h.fn.updateGridsterLayoutSettings=function(){var k=c.serialize();h("input#gridster_layout").val(JSON.stringify(k));return};var d={grid:[a+(g*2),j+(f*2)],animate:false,minWidth:a,minHeight:j,containment:".gridster ul",handles:"se",autoHide:true,resize:function(k,l){if(h(this).find("img").length){h(this).addClass("isUpdated")}},stop:function(l,m){var k=h(this);setTimeout(function(){h.fn.resizeBlock(k);if(h(k).find("img").length){h.fn.refreshWidgetHtml(k.data().post_id,false,k)}h.fn.updateGridsterLayoutSettings()},300)}};var i={no_results_text:gridster_admin.chosenNoResultsText};c=h(".gridster ul").gridster({widget_margins:[g,f],widget_base_dimensions:[a,j],avoid_overlapped_widgets:true,serialize_params:function(n,k){var m=h.trim(h("<div/>").text(h(n).find(".admin-html-holder").html()).html());var l=h(n).find(".dynamic-classes-chosen").val();return{size_x:k.size_x,size_y:k.size_y,col:k.col,row:k.row,id:h(n).attr("data-post_id"),html:m,classes:l}},draggable:{handle:".move-handle",stop:function(k,l){h.fn.updateGridsterLayoutSettings()}},collision:{on_overlap_start:function(k){},on_overlap_stop:function(k){}}}).data("gridster");h(".gridster").droppable({drop:function(l,m){var k=h(m.draggable).attr("rel");h.fn.updateQueryNotInField(k);m.helper.remove();h("#gridster_load-wrap").fadeIn();h.fn.refreshWidgetHtml(k,true)}});h.fn.refreshWidgetHtml=function(n,k,l){k=typeof k!=="undefined"?k:false;l=typeof l!=="undefined"?l:null;var m={post_id:n,widget_width:(l)?l.width():a,widget_height:(l)?l.height():j};h.ajax({type:"GET",url:gridster_admin.ajaxUrl,dataType:"html",data:({action:"ajax_gridster_get_post",nonce:gridster_admin.ajaxNonce,options:m}),success:function(o){if(o=="-1"||o===""||o===0||o=="undefined"){var q=h("#gridster_loader p").html();h("#gridster_loader").addClass("error");h("#gridster_loader p").text(gridster_admin.textAjaxLoadProblem);h("#gridster_load-wrap").fadeOut(5000,function(){h("#gridster_loader").removeClass("error");h("#gridster_loader p").html(q)})}else{if(k===true){var p=h("<li>").attr("data-post_id",n).html(o);p.resizable(d);p.append(h.fn.AddUiElemnts());c.add_widget(p,1,1);h.fn.initChosen(h('li.gs_w[data-post_id="'+n+'"]'));h.fn.updateGridsterLayoutSettings();h("#gridster_load-wrap").fadeOut()}else{h(l).find("div.admin-html-holder").replaceWith(o);h(l).removeClass("isUpdated");h.fn.updateGridsterLayoutSettings()}h.fn.initJeditable()}}})};h.fn.updateQueryNotInField=function(n,k){k=typeof k!=="undefined"?k:false;var r=parseInt(n,10);var q=h("input#gridster_query_posts_not_in").val();if(k!==false){var m=q.split(",");m=m.map(function(s){return parseInt(s,10)});var l=m.indexOf(r);if(l<0){return}m.splice(l,1);h("input#gridster_query_posts_not_in").val(m.join(","));return}var o=new RegExp("(^|\\b)"+r+"(\\b|$)");if(!o.test(q)){var p=q+(q.length?",":"")+n;h("input#gridster_query_posts_not_in").val(p)}return};h.fn.AddUiElemnts=function(){var k=h("<div />").addClass("meta-label");h("<span />").attr("title",gridster_admin.textMoveHandle).text(gridster_admin.textMoveHandle).addClass("ir move-handle").appendTo(k);h("<span />").attr("title",gridster_admin.textDelete).text(gridster_admin.textDelete).addClass("ir delete-post").appendTo(k);return k};h(document).on({mouseenter:function(){c.disable()},mouseleave:function(){c.enable()}},".ui-resizable-handle");h(document).on("click",".gridster li .admin-html-holder a",function(k){k.preventDefault()});h(".delete-post").live("click",function(){h(this).parent().parent().hide("fast",function(){var k=parseInt(h(this).data().post_id,10);h.fn.updateQueryNotInField(k,true);c.remove_widget(h(this));h.fn.updateGridsterLayoutSettings()})});h.fn.initJeditable=function(){h(".gridster_edit").editable(function(l,k){return(l)},{onblur:"submit",data:function(k){return h.trim(k)},placeholder:"",callback:function(l,k){h.fn.updateGridsterLayoutSettings()}});h(".gridster_edit-area").editable(function(l,k){return(l)},{type:"autogrow",cancel:gridster_admin.JeditableCancel,submit:gridster_admin.JeditableOk,onblur:"submit",data:function(k){return h.trim(k)},placeholder:"",autogrow:{lineHeight:16,minHeight:32},callback:function(l,k){h.fn.updateGridsterLayoutSettings()}});h(".gridster_edit-area").on("click",function(){h('button[type="submit"]').addClass("button-primary");h('button[type="cancel"]').addClass("button-secondary")})};h.fn.initJeditable();h.fn.initChosen=function(m){if(gridster_admin.chosenSelectOptions!="[]"){var n=parseInt((m.width()-50-80),10);var o=(n>100)?n:100;var l=h("<select>").attr("multiple",true).attr("data-placeholder",gridster_admin.chosenSelectPlaceholder).addClass("dynamic-classes-chosen").width(o);var k=JSON.parse(gridster_admin.chosenSelectOptions);h.each(k,function(p,r){var q=h("<option>").val(p).text(r);if(m.hasClass(p)){q.attr("selected",true)}q.appendTo(l)});l.insertBefore(m.find("div.meta-label > span:first"));h("select.dynamic-classes-chosen").chosen(i).change(function(){h.fn.updateGridsterLayoutSettings()})}};h.fn.LoadWidgetsOnStart=function(){var l=h("input#gridster_layout").val();if(l===""||l==[]){return false}h("#gridster_load-wrap").fadeIn();var k=JSON.parse(l);h(k).each(function(){var n=h(this)[0];var m=h("<div>").addClass("admin-html-holder").html(n.html);m=h("<li>").attr("data-post_id",n.id).append(m);m.resizable(d);if(typeof n.classes!="undefined"&&n.classes!==null){m.addClass(n.classes.join(" "))}m.append(h.fn.AddUiElemnts());c.add_widget(m,n.size_x,n.size_y,n.col,n.row);h.fn.initChosen(h('li.gs_w[data-post_id="'+n.id+'"]'))});h.fn.initJeditable();h("#gridster_load-wrap").fadeOut();h.fn.updateGridsterLayoutSettings();return false};h.fn.updateMetaboxLayout=function(){var m=parseInt(h(".gridster ul").data("content_width"),10);var o=parseInt(h("#gridster_workbench_metabox").width(),10);var k=280+20;if((h("#post-body").hasClass("columns-1")&&((m+k)<o))||(h("#gridster_workbench_metabox").hasClass("two-columns")&&((m+k)>o))){h("#gridster_workbench_metabox").removeClass("two-columns").addClass("one-column");var l=h(".gridster_widget-block");var n=Math.round(l.length/2);l.filter(function(p){return(p+1)<=n}).wrapAll('<div class="accordion-wrap" />');l.filter(function(p){return(p+1)>n}).wrapAll('<div class="accordion-wrap" />')}else{if((h("#post-body").hasClass("columns-2")&&((m+k)<o))||(h("#gridster_workbench_metabox").hasClass("one-column")&&((m+k)<o))){h("#gridster_workbench_metabox").addClass("two-columns").removeClass("one-column");h(".accordion-wrap .gridster_widget-block").unwrap()}}};h.fn.getPostsByType=function(n,l,k){k=typeof k!=="undefined"?k:null;var m={post_type:n,paged:l,search:k};h.ajax({type:"GET",url:gridster_admin.ajaxUrl,dataType:"html",data:({action:"ajax_get_posts_by_type_widget_block",nonce:gridster_admin.ajaxNonce,options:m,post:h("#post_ID").val()}),success:function(p){if(p=="-1"||p===""||p===0||p=="undefined"){var o=h("<p />").text(gridster_admin.textAjaxNothingFound);o=h("<div />").addClass("error").append(o);h("#gridster_post_type-"+n+"-widget-block").find(".inside").html(o)}else{h("#gridster_post_type-"+n+"-widget-block").find(".inside").html(p);h(".gridster_widget-block li").draggable({revert:"invalid"})}h("#gridster_post_type-"+n+"-widget-block").find(".spinner").hide()}})};h(".gridster_widget-block").each(function(){var k=h(this).data("post_type");h.fn.getPostsByType(k,paged=1)});h(document).on("click",".widget-blocks-pagination",function(){h(this).parentsUntil(".gridster_widget-block").parent().find(".spinner").show();var m=h(this).parentsUntil(".gridster_widget-block").parent().data("post_type");var l=h(this).data("paged");var k=(h(this).data("search"))?h(this).data("search"):null;h.fn.getPostsByType(m,l,k)});var b;var e=2000;h(document).on("keyup",".gridster_search-posts-by-type",function(l){var k=h(this);if(l.which==13){l.preventDefault();h.fn.doneTyping(k)}else{b=setTimeout(function(){h.fn.doneTyping(k)},e)}});h(document).on("keydown",".gridster_search-posts-by-type",function(){clearTimeout(b)});h.fn.doneTyping=function(k){k.parentsUntil(".gridster_widget-block").parent().find(".spinner").show();var n=k.parentsUntil(".gridster_widget-block").parent().data("post_type");var m=1;var l=h.trim(k.val());h.fn.getPostsByType(n,m,l)}});jQuery(document).ready(function(b){b.fn.WidgetBlockAccordion=function(c){if(c.parent().hasClass("trigger_active")){c.siblings(".inside").slideToggle("fast");c.parent().removeClass("trigger_active");c.parent().siblings(".trigger_active").removeClass("trigger_active")}else{c.parent().siblings(".trigger_active").removeClass("trigger_active").find(".inside").slideToggle("fast");c.siblings(".inside").slideToggle("fast");c.parent().addClass("trigger_active")}return false};b(".gridster_widget-block h3, .gridster_widget-block .handlediv").not(".trigger_active").siblings(".inside").hide();b(".gridster_widget-block h3, .gridster_widget-block .handlediv").click(function(){b.fn.WidgetBlockAccordion(b(this))});b(".gridster_widget-block:first h3").trigger("click");var a=b(".gridster ul").data("content_width");b("<div />").addClass("content_width-border").attr("title",gridster_admin.textMaximumContentWidth).css("left",a+"px").appendTo(b(".gridster"));b.fn.LoadWidgetsOnStart();b.fn.updateMetaboxLayout();b(window).resize(function(){b.fn.updateMetaboxLayout()});b("#collapse-menu").on("click.collapse-menu",function(){setTimeout(function(){b.fn.updateMetaboxLayout()},500)});b(".columns-prefs input").on("change",function(){setTimeout(function(){b.fn.updateMetaboxLayout()},500)})});